#include "abnf.h"
#include "etape3.h"

void est_date1_restr(char *c, int l) {
	if(est_date1(c,l,"",0,NULL)==1){
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'J' && c[4] == 'a' && c[5] == 'n')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'M' && c[4] == 'a' && c[5] == 'a')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '0')) && (c[3] == 'A' && c[4] == 'p' && c[5] == 'r')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'M' && c[4] == 'a' && c[5] == 'y')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '0')) && (c[3] == 'J' && c[4] == 'u' && c[5] == 'n')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'J' && c[4] == 'u' && c[5] == 'l')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'A' && c[4] == 'o' && c[5] == 'u')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '0')) && (c[3] == 'S' && c[4] == 'e' && c[5] == 'p')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'O' && c[4] == 'c' && c[5] == 't')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '0')) && (c[3] == 'N' && c[4] == 'o' && c[5] == 'v')){
			semant_ok = 0;
		}
		if ((c[0] > '3' || (c[0] == '3' && c[1] > '1')) && (c[3] == 'D' && c[4] == 'e' && c[5] == 'c')){
			semant_ok = 0;
		}

		int k = 0;
		char sub[4];
		while (k < 11) {
			sub[k] = c[8+k-1];
			k++;
		}
		int annee = 0;
		for (k=0;k<4;k++) {
			annee *=10;
			annee +=sub[k];
		}
		if((bissextile(annee) == 1) && (c[0] > '2' && (c[3] == 'F' && c[4] == 'e' && c[5] == 'b'))){
			semant_ok = 0;
		}
		if((bissextile(annee) == 0) && (c[0] > '2' || (c[0] == '2' && c[1] > '8')) && (c[3] == 'F' && c[4] == 'e' && c[5] == 'b')){
			semant_ok = 0;
		}
	}
}
